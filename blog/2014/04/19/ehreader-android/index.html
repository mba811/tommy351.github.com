<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>E-Hentai 閱讀器 for Android | Zespia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta content="article" property="og:type">
<meta content="E-Hentai 閱讀器 for Android" property="og:title">
<meta content="http://zespia.tw/blog/2014/04/19/ehreader-android/" property="og:url">
<meta content="http://i.minus.com/iXV0rlAP1H4xI.jpg" property="og:image">
<meta content="Zespia" property="og:site_name">
<meta content="想必許多紳士都是 E-Hentai 的常客，我這邊就不細談這網站的內容了，這篇文章是久違的技術文，主要是來說明 E-Hentai 閱讀器 的 發牢騷 製作過程。" property="og:description">
<meta content="summary" name="twitter:card">
<meta content="tommy351" name="twitter:creator">
<link rel="publisher" href="108777679171675250079">
<meta content="100000247608790" property="fb:admins">
  
    <link rel="alternative" href="/atom.xml" title="Zespia" type="application/atom+xml">
  
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-4910098-7', 'zespia.tw');
ga('require', 'displayfeatures');
ga('send', 'pageview');
</script>

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Zespia</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="https://github.com/tommy351">GitHub</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://zespia.tw"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ehreader-android" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/04/19/ehreader-android/" class="article-date">
  <time datetime="2014-04-19T10:14:10.000Z" itemprop="datePublished">2014/4/19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      E-Hentai 閱讀器 for Android
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://i.minus.com/iXV0rlAP1H4xI.jpg" alt=""></p>
<p>想必許多紳士都是 <a href="http://e-hentai.org/" target="_blank">E-Hentai</a> 的常客，我這邊就不細談這網站的內容了，這篇文章是久違的技術文，主要是來說明 <a href="https://github.com/tommy351/ehreader-android" target="_blank">E-Hentai 閱讀器</a> 的 <del>發牢騷</del> 製作過程。</p>
<a id="more"></a>

<h2 id=" 編輯器 ">編輯器</h2>
<p><img src="http://i.minus.com/iJ3U8oypGWdoA.png" alt=""></p>
<p>Android 開發實在不是件簡單的事，一開始開發時使用 <a href="https://www.eclipse.org/" target="_blank">Eclipse</a>，恰好時逢 Android SDK 推出，結果一更新 SDK，林北的專案就爆炸惹，我也不知道到底該怎麼救，於是一氣之下怒換到 <a href="http://developer.android.com/sdk/installing/studio.html" target="_blank">Android Studio</a>，<a href="http://developer.android.com/sdk/installing/studio.html" target="_blank">Android Studio</a> 基於 <a href="http://www.jetbrains.com/idea/" target="_blank">IntelliJ IDEA</a>，速度比 <a href="https://www.eclipse.org/" target="_blank">Eclipse</a> 快多了，介面也比 <a href="https://www.eclipse.org/" target="_blank">Eclipse</a> 美觀許多，而且預設採用 <a href="http://www.gradle.org/" target="_blank">Gradle</a> 做為建置工具。</p>
<p><img src="http://i.minus.com/iimYRbRDx23to.png" alt=" 使用 Genymotion 運行 Android 4.4.2"></p>
<p>之前就聽說過 iOS 開發友善許多，實際體驗後深深了解此言絕非虛假，Android 模擬器的效能實在不是一般的慢，光開機就需要數分鐘，而且一切的操作都比實機慢上許多倍，根本無法使用，根本逼人買一台 Nexus，後來改用 <a href="http://www.genymotion.com/" target="_blank">Genymotion</a>，才終於找回正常模擬器該有的速度，iOS 的開發環境就好多了，從 Build 到 Deploy 只要半分鐘即可在模擬器上操作。</p>
<p>一般來說，開發專案絕對會用到很多 Library，因此需要有個 Dependency Manager 來管理套件之間的相依性問題，Java 因為歷史悠久，因此有許多選擇，使用 <a href="https://www.eclipse.org/" target="_blank">Eclipse</a> 時，我本來選用 <a href="http://maven.apache.org/" target="_blank">Maven</a>，但是它使用 XML 檔實在令人討厭，舉例來說：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">dependencies</span>&gt;</span>
    <span class="tag">&lt;<span class="title">dependency</span>&gt;</span>
        <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.jakewharton<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span>
        <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>butterknife<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span>
        <span class="tag">&lt;<span class="title">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span>
<span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span>
</pre></td></tr></table></figure>


<p>倒也不是討厭 XML 本身，我認為 XML 是一個規範良好的標記語言，但在上面的程式碼中，僅僅要引入一個套件就得寫這麼長的代碼也未免太囉嗦了，而 <a href="http://www.gradle.org/" target="_blank">Gradle</a> 採用 <a href="http://groovy.codehaus.org/" target="_blank">Groovy</a>，讓一切變得更簡單：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>dependencies <span class="cell">{
    compile <span class="string">'com.jakewharton:butterknife:4.0.1'</span>
}</span>
</pre></td></tr></table></figure>


<p>如上，只要寫一行代碼就能引入一個套件，再也不用寫一長串的 XML，而且 Gradle 也能支援 <a href="http://search.maven.org/" target="_blank">Maven Central</a>，因此不用擔心沒有 Library 能用。</p>
<h2 id="E-Hentai_API">E-Hentai API</h2>
<p>一開始我根本不知道有 API 的存在，所以使用 <a href="http://jsoup.org/" target="_blank">jsoup</a> 來爬網站，<a href="http://jsoup.org/" target="_blank">jsoup</a> 能在 Java 上用類似 <a href="http://jquery.com/" target="_blank">jQuery</a> 的語法來遍歷資料，但是效能實在不佳。我曾有想過用 Node.js 做為後端伺服器，但為了避免流量過大被 E-Hentai 封鎖，放棄了這個想法。</p>
<p>之後某天，在瀏覽時偶然開啟 Firebug，發現到瀏覽圖片時會使用 Ajax 與伺服器取得資料，才了解到原來有 <a href="http://ehwiki.org/wiki/API" target="_blank">E-Hentai API</a>。雖然有 API 是好事，但這 API 實在寫得太爛了，舉例來說，若要取得一個相簿的資料，我們必須先了解 E-Hentai 的網址結構：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>http://g.e-hentai.org/g/{gallery_id}/{gallery_token}/
</pre></td></tr></table></figure>


<p><code>gallery_id</code> 代表 Gallery ID，是一個唯一的有序整數，而 <code>gallery_token</code> 是一個隨機的字串。若要取得相簿資料，這兩個欄位是必須的。但是在一開始，根本無從得知 <code>gallery_token</code>，只能從首頁中把網址抓出來。</p>
<p>接下來是圖片資料，E-Hentai API 並沒有提供「相片列表」的 API，因此，我們又必須利用從相簿頁面中把圖片網址抓出來，而圖片的網址結構如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>http://g.e-hentai.org/s/{page_token}/{gallery_id}-{pagenumber}
</pre></td></tr></table></figure>


<p><code>page_token</code> 代表相片的 token，推測是原始檔案 SHA1 checksum 的前 10 碼，<code>gallery_id</code> 是相簿 ID，<code>pagenumber</code> 則是頁數。<strong>注意</strong>，<code>page_token</code> <strong>不等於</strong> <code>gallery_token</code>，使得取得相片資料變得更加困難。</p>
<p>在 <a href="http://ehwiki.org/wiki/API" target="_blank">wiki</a> 中，並沒有提到如何透過 API 取得圖片網址，我們無法單從 <code>page_token</code> 推測出圖片網址，只能從圖片頁面中找到蛛絲馬跡，後來我發現到圖片頁面中會使用如下指令取得資料：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>{
  "<span class="attribute">method</span>": <span class="value"><span class="string">"showpage"</span></span>,
  "<span class="attribute">gid</span>": <span class="value"><span class="number">618395</span></span>,
  "<span class="attribute">page</span>": <span class="value"><span class="number">1</span></span>,
  "<span class="attribute">imgkey</span>": <span class="value"><span class="string">"1463dfbc16"</span></span>,
  "<span class="attribute">showkey</span>": <span class="value"><span class="string">"387132-43f9269494"</span>
</span>}
</pre></td></tr></table></figure>


<p><code>gid</code> 等於 <code>gallery_id</code>，<code>page</code> 等於 <code>pagenumber</code>，<code>imgkey</code> 等於 <code>page_token</code>，但是 <code>showkey</code> 呢？<code>showkey</code> 是每 24 小時就會隨機變換的 token，同樣藏在圖片頁面中，只能自己爬資料。</p>
<p>綜上所述，這個 API 真的么壽難用，有很多資料是無法從 API 取得的，只能自己爬資料，令我覺得 Android 開發與之相比簡單多了，各位如果想知道更多關於 <a href="http://ehwiki.org/wiki/API" target="_blank">E-Hentai API</a> 的資料的話，可參考我做的 <a href="https://github.com/tommy351/ehreader-android/wiki/E-Hentai-JSON-API" target="_blank">整理</a>。</p>
<h2 id=" 介面 ">介面</h2>
<p><img src="http://i.minus.com/igtO6Z5Tg3EmS.png" alt=""></p>
<p>Android 雖然提供了所見即所得的介面編輯器，但若要進行進一步的調整還是得自己編輯 XML 檔，更不用說預覽畫面常與實際畫面不符，根本所見非所得。</p>
<p>網頁開發與 Android 的介面設計有很多相似之處，但是有些介面元素在 CSS 上很容易實現，在 Android 上卻麻煩許多，例如：圓角、陰影等，在 CSS 中分別只要透過 <code>border-radius</code>, <code>box-shadow</code> 即可達成，在 Android 上卻麻煩許多。</p>
<h2 id=" 結語 ">結語</h2>
<p><img src="http://i.minus.com/iKXI5aMhSXYFB.PNG" alt=""></p>
<p>其實這專案從去年 5 月就已經開始計畫了，不過因為 <del>中途一直碰壁很不爽</del> 時間不夠，所以直到今年，才用了春節兩週的時間將舊有程式碼完全翻新，開發出了 0.1.0 版。雖然現在已經 0.4.0 版了，還是很多 bug，每天仍有 400 多名活躍使用者實在太感謝了。</p>
<p>如果各位在使用時發現任何問題或建議，請到 <a href="https://github.com/tommy351/ehreader-android/issues" target="_blank">GitHub</a> 發表，也歡迎各位加入開發讓這個程式變得更加好用。</p>
<ul>
<li><a href="https://github.com/tommy351/ehreader-android" target="_blank">GitHub</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zespia.tw/blog/2014/04/19/ehreader-android/" data-id="w9ap2d6qtr0uy3cv" class="article-share-link">Share</a>
      
        <a href="http://zespia.tw/blog/2014/04/19/ehreader-android/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/E-Hentai/">E-Hentai</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/blog/2014/04/13/atelier-escha-logy/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">愛絲卡＆羅吉的鍊金工房 ─ 黃昏天空之鍊金術士</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 SkyArrow<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="https://github.com/tommy351" class="mobile-nav-link">GitHub</a>
  
</nav>
    
<script>
  var disqus_shortname = 'zespiatw';
  
  var disqus_url = 'http://zespia.tw/blog/2014/04/19/ehreader-android/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script type="text/javascript" src="/js/script.js"></script>
  </div>
</body>
</html>